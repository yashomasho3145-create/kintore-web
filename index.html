<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>筋トレフォーム分析ツール</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="container">
        <!-- ヘッダー -->
        <header class="header">
            <h1>筋トレフォーム分析ツール</h1>
            <p class="subtitle">リアルタイム回数カウント & AI評価</p>
        </header>

        <!-- メインコンテンツ -->
        <main class="main-content">
            <!-- ビデオエリア -->
            <div class="video-container">
                <video id="video" autoplay playsinline></video>
                <canvas id="canvas"></canvas>

                <!-- オーバーレイ情報 -->
                <div class="overlay-info">
                    <div class="info-item mode">
                        <span class="label">Mode:</span>
                        <span id="modeDisplay">AUTO</span>
                    </div>
                    <div class="info-item exercise">
                        <span class="label">Exercise:</span>
                        <span id="exerciseDisplay">検出中...</span>
                    </div>
                    <div class="info-item count">
                        <span id="countDisplay">0</span>
                        <span id="targetDisplay"></span>
                    </div>
                    <div class="info-item stage">
                        <span class="label">Stage:</span>
                        <span id="stageDisplay">-</span>
                    </div>
                    <div class="info-item angle">
                        <span class="label">Angle:</span>
                        <span id="angleDisplay">-</span>
                    </div>
                    <div class="info-item reps-recorded">
                        <span class="label">Reps recorded:</span>
                        <span id="repsRecordedDisplay">0</span>
                    </div>
                </div>

                <!-- 右上ステータス -->
                <div class="status-indicators">
                    <div class="status-item">
                        <span class="label">Voice:</span>
                        <span id="voiceStatus" class="status-on">ON</span>
                    </div>
                    <div class="status-item">
                        <span class="label">n8n:</span>
                        <span id="n8nStatus" class="status-off">未接続</span>
                    </div>
                    <div class="status-item" id="scoreContainer" style="display: none;">
                        <span class="label">Score:</span>
                        <span id="scoreDisplay">-</span>
                    </div>
                </div>

                <!-- ローディング -->
                <div id="loadingOverlay" class="loading-overlay">
                    <div class="loading-spinner"></div>
                    <p>MediaPipeを読み込み中...</p>
                </div>
            </div>

            <!-- コントロールパネル -->
            <div class="control-panel">
                <!-- 種目選択 -->
                <div class="control-section">
                    <h3>種目選択</h3>
                    <div class="button-group">
                        <button id="btnAuto" class="btn btn-mode active">自動判定</button>
                        <button id="btnPushup" class="btn btn-exercise">腕立て伏せ</button>
                        <button id="btnSitup" class="btn btn-exercise">腹筋</button>
                        <button id="btnSquat" class="btn btn-exercise">スクワット</button>
                    </div>
                </div>

                <!-- アクション -->
                <div class="control-section">
                    <h3>アクション</h3>
                    <div class="button-group">
                        <button id="btnReset" class="btn btn-action">リセット</button>
                        <button id="btnVoice" class="btn btn-action active">音声 ON</button>
                        <button id="btnEvaluate" class="btn btn-primary">AI評価</button>
                    </div>
                </div>

                <!-- 設定 -->
                <div class="control-section">
                    <h3>設定</h3>
                    <div class="setting-item">
                        <label for="targetCount">目標回数:</label>
                        <input type="number" id="targetCount" min="0" value="0" placeholder="0=無制限">
                        <button id="btnSetTarget" class="btn btn-small">設定</button>
                    </div>
                    <div class="setting-item">
                        <label for="webhookUrl">n8n URL:</label>
                        <input type="text" id="webhookUrl" placeholder="https://your-n8n.com/webhook/...">
                        <button id="btnTestConnection" class="btn btn-small">接続テスト</button>
                    </div>
                </div>
            </div>

            <!-- 評価結果パネル -->
            <div id="evaluationPanel" class="evaluation-panel" style="display: none;">
                <h3>AI評価結果</h3>
                <div class="evaluation-content">
                    <div class="score-display">
                        <span class="score-label">総合スコア</span>
                        <span id="evaluationScore" class="score-value">-</span>
                        <span class="score-max">/100</span>
                    </div>
                    <div class="comment-display">
                        <p id="evaluationComment"></p>
                    </div>
                </div>
                <button id="btnCloseEvaluation" class="btn btn-small">閉じる</button>
            </div>
        </main>

        <!-- フッター -->
        <footer class="footer">
            <p>操作: 種目ボタンで切り替え | リセットでカウント初期化 | AI評価でフォーム分析</p>
        </footer>
    </div>

    <!-- MediaPipe -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose@0.5.1675469404/pose.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils@0.3.1675466862/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils@0.3.1675466124/drawing_utils.js" crossorigin="anonymous"></script>

    <!-- アプリケーション -->
    <script src="js/voice.js"></script>
    <script src="js/counter.js"></script>
    <script src="js/pose.js"></script>
    <script src="js/api.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
